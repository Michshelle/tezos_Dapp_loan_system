{"ast":null,"code":"import _regeneratorRuntime from\"/Users/shengyisong/Documents/githubs/tezos-react-tutorial/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/shengyisong/Documents/githubs/tezos-react-tutorial/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/shengyisong/Documents/githubs/tezos-react-tutorial/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";var upperFirst=function upperFirst(str){return str[0].toUpperCase()+str.slice(1);};var mutezToTez=function mutezToTez(mutez){return Math.round((parseInt(mutez)/1000000+Number.EPSILON)*100)/100;};var Menu=function Menu(_ref){var coffeeMenu=_ref.coffeeMenu,contractInstance=_ref.contractInstance,userAddress=_ref.userAddress,setBalance=_ref.setBalance,Tezos=_ref.Tezos,userPoints=_ref.userPoints,setUserPoints=_ref.setUserPoints;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),txStatus=_useState2[0],setTxStatus=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),txHash=_useState4[0],setTxHash=_useState4[1];var buyCoffee=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(coffee,price){var op,newBalance;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return contractInstance.methods.buy(coffee).send({amount:price,mutez:true});case 3:op=_context.sent;console.log(op);if(!(op.status===\"applied\")){_context.next=10;break;}setTxStatus(\"applied\");setTxHash(op.hash);_context.next=12;break;case 10:setTxStatus(\"error\");throw Error(\"Transation not applied\");case 12:_context.next=14;return op.confirmation(1);case 14:if(!(op.includedInBlock!==Infinity)){_context.next=23;break;}setTxStatus(\"included\");_context.next=18;return Tezos.tz.getBalance(userAddress);case 18:newBalance=_context.sent;setBalance(newBalance);setUserPoints(userPoints+1);_context.next=24;break;case 23:throw Error(\"Transation not included in block\");case 24:_context.next=29;break;case 26:_context.prev=26;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 29:case\"end\":return _context.stop();}}},_callee,null,[[0,26]]);}));return function buyCoffee(_x,_x2){return _ref2.apply(this,arguments);};}();if(txStatus===null){var redeemPointsButton=\"\";if(userPoints===undefined){redeemPointsButton=React.createElement(\"span\",null,\"No point available\");}else if(userPoints>=0&&userPoints<=9){redeemPointsButton=React.createElement(\"span\",null,\"Available points: \",userPoints);}else if(userPoints===10){redeemPointsButton=React.createElement(\"span\",{className:\"action\"},\"Redeem Points\");}return React.createElement(React.Fragment,null,React.createElement(\"div\",{className:\"app-subtitle\"},\"Please choose your coffee:\"),coffeeMenu.map(function(coffee){return React.createElement(\"div\",{className:\"card coffee_selection\",key:coffee.name},React.createElement(\"div\",{className:\"card-content\"},upperFirst(coffee.name),\" (\\uA729 \",mutezToTez(coffee.price),\")\"),userAddress&&React.createElement(\"div\",{className:\"card-footer\"},React.createElement(\"p\",{className:\"card-footer-item\"},React.createElement(\"span\",{className:\"action\",onClick:function onClick(){return buyCoffee(coffee.name,coffee.price);}},\"Buy\")),React.createElement(\"p\",{className:\"card-footer-item\"},redeemPointsButton)));}));}else if(txStatus===\"applied\"){return React.createElement(\"div\",{className:\"message is-info\"},React.createElement(\"div\",{className:\"message-header\"},React.createElement(\"p\",null,\"Waiting for confirmation\")),React.createElement(\"div\",{className:\"message-body\"},React.createElement(\"p\",null,\"Your transaction is being processed, please wait.\"),React.createElement(\"p\",{className:\"coffee-loader\"},React.createElement(\"img\",{src:\"coffee-cup.png\",alt:\"coffee-cup\"})),React.createElement(\"p\",null,\"Transaction number: \",txHash)));}else if(txStatus===\"included\"){return React.createElement(\"div\",{className:\"message is-success\"},React.createElement(\"div\",{className:\"message-header\"},React.createElement(\"p\",null,\"Transaction confirmed!\")),React.createElement(\"div\",{className:\"message-body\"},React.createElement(\"p\",null,\"Enjoy your coffee!\"),React.createElement(\"br\",null),React.createElement(\"p\",null,React.createElement(\"button\",{className:\"button is-info\",onClick:function onClick(){return setTxStatus(null);}},\"Buy a new coffee\"))));}else if(txStatus===\"error\"){return React.createElement(\"div\",{className:\"message is-danger\"},React.createElement(\"div\",{className:\"message-header\"},React.createElement(\"p\",null,\"Error\")),React.createElement(\"div\",{className:\"message-body\"},React.createElement(\"p\",null,\"An error has occurred, please try again.\")));}};export default Menu;","map":{"version":3,"sources":["/Users/shengyisong/Documents/githubs/tezos-react-tutorial/client/src/Menu.js"],"names":["React","useState","upperFirst","str","toUpperCase","slice","mutezToTez","mutez","Math","round","parseInt","Number","EPSILON","Menu","coffeeMenu","contractInstance","userAddress","setBalance","Tezos","userPoints","setUserPoints","txStatus","setTxStatus","undefined","txHash","setTxHash","buyCoffee","coffee","price","methods","buy","send","amount","op","console","log","status","hash","Error","confirmation","includedInBlock","Infinity","tz","getBalance","newBalance","redeemPointsButton","map","name"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\n\nconst upperFirst = str => str[0].toUpperCase() + str.slice(1);\n\nconst mutezToTez = mutez =>\n  Math.round((parseInt(mutez) / 1000000 + Number.EPSILON) * 100) / 100;\n\nconst Menu = ({\n  coffeeMenu,\n  contractInstance,\n  userAddress,\n  setBalance,\n  Tezos,\n  userPoints,\n  setUserPoints\n}) => {\n  const [txStatus, setTxStatus] = useState(null);\n  const [txHash, setTxHash] = useState(undefined);\n\n  const buyCoffee = async (coffee, price) => {\n    try {\n      const op = await contractInstance.methods\n        .buy(coffee)\n        .send({ amount: price, mutez: true });\n      console.log(op);\n      if (op.status === \"applied\") {\n        setTxStatus(\"applied\");\n        setTxHash(op.hash);\n      } else {\n        setTxStatus(\"error\");\n        throw Error(\"Transation not applied\");\n      }\n\n      await op.confirmation(1);\n      if (op.includedInBlock !== Infinity) {\n        setTxStatus(\"included\");\n        const newBalance = await Tezos.tz.getBalance(userAddress);\n        setBalance(newBalance);\n        setUserPoints(userPoints + 1);\n      } else {\n        throw Error(\"Transation not included in block\");\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  if (txStatus === null) {\n    let redeemPointsButton = \"\";\n    if (userPoints === undefined) {\n      redeemPointsButton = <span>No point available</span>;\n    } else if (userPoints >= 0 && userPoints <= 9) {\n      redeemPointsButton = <span>Available points: {userPoints}</span>;\n    } else if (userPoints === 10) {\n      redeemPointsButton = <span className=\"action\">Redeem Points</span>;\n    }\n\n    return (\n      <>\n        <div className=\"app-subtitle\">Please choose your coffee:</div>\n        {coffeeMenu.map(coffee => (\n          <div className=\"card coffee_selection\" key={coffee.name}>\n            <div className=\"card-content\">\n              {upperFirst(coffee.name)} (ꜩ {mutezToTez(coffee.price)})\n            </div>\n            {userAddress && (\n              <div className=\"card-footer\">\n                <p className=\"card-footer-item\">\n                  <span\n                    className=\"action\"\n                    onClick={() => buyCoffee(coffee.name, coffee.price)}\n                  >\n                    Buy\n                  </span>\n                </p>\n                <p className=\"card-footer-item\">{redeemPointsButton}</p>\n              </div>\n            )}\n          </div>\n        ))}\n      </>\n    );\n  } else if (txStatus === \"applied\") {\n    return (\n      <div className=\"message is-info\">\n        <div className=\"message-header\">\n          <p>Waiting for confirmation</p>\n        </div>\n        <div className=\"message-body\">\n          <p>Your transaction is being processed, please wait.</p>\n          <p className=\"coffee-loader\">\n            <img src=\"coffee-cup.png\" alt=\"coffee-cup\" />\n          </p>\n          <p>Transaction number: {txHash}</p>\n        </div>\n      </div>\n    );\n  } else if (txStatus === \"included\") {\n    return (\n      <div className=\"message is-success\">\n        <div className=\"message-header\">\n          <p>Transaction confirmed!</p>\n        </div>\n        <div className=\"message-body\">\n          <p>Enjoy your coffee!</p>\n          <br />\n          <p>\n            <button\n              className=\"button is-info\"\n              onClick={() => setTxStatus(null)}\n            >\n              Buy a new coffee\n            </button>\n          </p>\n        </div>\n      </div>\n    );\n  } else if (txStatus === \"error\") {\n    return (\n      <div className=\"message is-danger\">\n        <div className=\"message-header\">\n          <p>Error</p>\n        </div>\n        <div className=\"message-body\">\n          <p>An error has occurred, please try again.</p>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default Menu;\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"/Users/shengyisong/Documents/githubs/tezos-react-tutorial/client/src/App.js\";\nimport React, { useState, useEffect, Component } from \"react\";\nimport { Tezos } from \"@taquito/taquito\";\nimport { TezBridgeSigner } from \"@taquito/tezbridge-signer\";\nimport Menu from \"./Menu\";\nimport \"./App.css\";\nimport \"./bulma.css\";\n/* PUT HERE THE CONTRACT ADDRESS FOR YOUR OWN SANDBOX! */\n\nconst KT_ledger = \"KT1RigSYegqvkCkEoHMfgXY4XLgknZufrFEa\";\nconst KT_token = \"KT1GxBkvP5aiAtBu9MwAWBgxRpaCeLCcBfNj\";\n\nconst shortenAddress = addr => addr.slice(0, 6) + \"...\" + addr.slice(addr.length - 6); // Our component now is a full class\n\n\nclass TezosDisplay extends Component {\n  constructor(props) {\n    super(props); // Start with no response available\n\n    this.state = {\n      response: false\n    };\n  } // Waits the component to be rendered before calling API\n\n\n  componentDidMount() {\n    axios.get(url).then(response => {\n      // Updates the state with the response\n      this.setState({\n        response\n      });\n    });\n  } // Renders the component with the available data\n\n\n  render() {\n    if (!this.state.response) {\n      // Show a loading state because data may not be available yet\n      return 'Loading data...';\n    } else {\n      return React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }, response.data[0]);\n    }\n  }\n\n}\n\nReactDOM.render(XtzDisplay, document.getElementById('app'));\n\nconst App = () => {\n  const [tokenInstance, setTokenInstance] = useState(undefined);\n  const [ledgerInstance, setLedgerInstance] = useState(undefined);\n  const [ledgerInfo, setLedgerInfo] = useState(undefined);\n  const [userAddress, setUserAddress] = useState(undefined);\n  const [balance, setBalance] = useState(undefined);\n  const [isOwner, setIsOwner] = useState(false);\n  const [contractBalance, setContractBalance] = useState(0);\n  const tezbridge = window.tezbridge;\n\n  const tezosPrice = async () => {\n    try {\n      const req = await fetch(`https://api-pub.bitfinex.com/v2/ticker/tXTZUSD`);\n      const response = await req.json();\n\n      const _xtz = Number(response[0]);\n\n      setXtzPrice(_xtz);\n    } catch (error) {\n      console.log(\"error fetching xtz price:\", error);\n    }\n  };\n\n  const initWallet = async () => {\n    try {\n      // sets rpc host\n\n      /*const rpc = await tezbridge.request({\n        method: \"set_host\",\n        host: \"http://localhost:8732\"\n      });*/\n      // gets user's address\n      const _address = await tezbridge.request({\n        method: \"get_source\"\n      });\n\n      setUserAddress(_address); // gets user's balance\n\n      const _balance = await Tezos.tz.getBalance(_address);\n\n      setBalance(_balance);\n      const storage = await tokenInstance.storage();\n\n      if (storage.owner === _address) {\n        setIsOwner(true);\n\n        const _contractBalance = await Tezos.tz.getBalance(KT_token);\n\n        setContractBalance(_contractBalance.c[0]);\n      }\n    } catch (error) {\n      console.log(\"error fetching the address or balance:\", error);\n    }\n  };\n\n  const mint = async (mintNumber, xtz) => {\n    // sends mint request\n    const price = mintNumber / 1000000 / xtz;\n    const op = await tokenInstance.methods.mint(mintNumber).send({\n      amount: price.toFixed(4)\n    }); // waits for confirmation\n\n    await op.confirmation(30); // if confirmed\n\n    if (op.includedInBlock !== Infinity) {\n      const newBalance = await Tezos.tz.getBalance(userAddress);\n      setBalance(newBalance);\n    } else {\n      console.log(\"error\");\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      // sets RPC\n      Tezos.setProvider({\n        rpc: \"https://tezos-dev.cryptonomic-infra.tech\",\n        signer: new TezBridgeSigner()\n      }); // fetches contract storage\n\n      const tokenContract = await Tezos.contract.at(KT_token);\n      setTokenInstance(tokenContract);\n      const ledgerContract = await Tezos.contract.at(KT_ledger);\n      setLedgerInstance(ledgerContract);\n      const ledgerStorage = await ledgerContract.storage(); // creates token contract info\n\n      let ledgerInfos = [ledgerStorage.debtor, ledgerStorage.totalCredit];\n      setLedgerInfo(ledgerInfos);\n    })();\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"wallet\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, balance === undefined ? React.createElement(\"button\", {\n    className: \"button is-info is-light is-small\",\n    onClick: initWallet,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, \"Connect your wallet\") : React.createElement(React.Fragment, null, React.createElement(\"span\", {\n    className: \"balance\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }, \"\\uA729 \", balance.toNumber() / 1000000), React.createElement(\"div\", {\n    className: \"field is-grouped\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    className: \"control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"button is-success is-light is-small\",\n    onClick: async () => {\n      setUserAddress(undefined);\n      setBalance(undefined);\n      setIsOwner(undefined);\n      setXtzPrice(undefined);\n      await initWallet();\n      await tezosPrice();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }, shortenAddress(userAddress))), isOwner && React.createElement(\"p\", {\n    className: \"control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"button is-warning is-light is-small\",\n    onClick: async () => {\n      mint(document.getElementById(\"tokenNumber\").value, response.data[0]);\n      document.getElementById(\"tokenNumber\").value = \"\"; // get xtz price\n      //if (typeof xtzPrice !== 'undefined') {\n      //  mint(document.getElementById(\"tokenNumber\").value,xtzPrice);\n      //  document.getElementById(\"tokenNumber\").value = \"\";\n      //} else {\n      //  setTimeout(1000)\n      //} \n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, \"Mint token\"), React.createElement(\"input\", {\n    type: \"text\",\n    id: \"tokenNumber\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }))))), React.createElement(\"div\", {\n    className: \"app-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, \"Flexible Loans\"), React.createElement(\"div\", {\n    className: \"logo\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: \"coffee-maker.png\",\n    alt: \"logo\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  })), typeof ledgerInfo === 'undefined' ? \"Loading the ledger info...\" : React.createElement(Menu, {\n    ledgerInfo: ledgerInfo,\n    tokenInstance: tokenInstance,\n    ledgerInstance: ledgerInstance,\n    userAddress: userAddress //xtzPrice={xtzPrice}\n    ,\n    setBalance: setBalance,\n    Tezos: Tezos,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }));\n};\n\nexport default App;","map":{"version":3,"sources":["/Users/shengyisong/Documents/githubs/tezos-react-tutorial/client/src/App.js"],"names":["React","useState","useEffect","Component","Tezos","TezBridgeSigner","Menu","KT_ledger","KT_token","shortenAddress","addr","slice","length","TezosDisplay","constructor","props","state","response","componentDidMount","axios","get","url","then","setState","render","data","ReactDOM","XtzDisplay","document","getElementById","App","tokenInstance","setTokenInstance","undefined","ledgerInstance","setLedgerInstance","ledgerInfo","setLedgerInfo","userAddress","setUserAddress","balance","setBalance","isOwner","setIsOwner","contractBalance","setContractBalance","tezbridge","window","tezosPrice","req","fetch","json","_xtz","Number","setXtzPrice","error","console","log","initWallet","_address","request","method","_balance","tz","getBalance","storage","owner","_contractBalance","c","mint","mintNumber","xtz","price","op","methods","send","amount","toFixed","confirmation","includedInBlock","Infinity","newBalance","setProvider","rpc","signer","tokenContract","contract","at","ledgerContract","ledgerStorage","ledgerInfos","debtor","totalCredit","toNumber","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Component } from \"react\";\nimport { Tezos } from \"@taquito/taquito\";\nimport { TezBridgeSigner } from \"@taquito/tezbridge-signer\";\nimport Menu from \"./Menu\";\nimport \"./App.css\";\nimport \"./bulma.css\";\n\n\n/* PUT HERE THE CONTRACT ADDRESS FOR YOUR OWN SANDBOX! */\nconst KT_ledger = \"KT1RigSYegqvkCkEoHMfgXY4XLgknZufrFEa\"\nconst KT_token = \"KT1GxBkvP5aiAtBu9MwAWBgxRpaCeLCcBfNj\"\n\n\nconst shortenAddress = addr =>\n  addr.slice(0, 6) + \"...\" + addr.slice(addr.length - 6);\n\n// Our component now is a full class\nclass TezosDisplay extends Component {\n\n  constructor(props) {\n    super(props);\n\n    // Start with no response available\n    this.state = {response: false}; \n  }\n\n  // Waits the component to be rendered before calling API\n  componentDidMount() {\n    axios.get(url).then(response => {\n        // Updates the state with the response\n        this.setState({ response })\n    });\n  }\n\n  // Renders the component with the available data\n  render() {\n    if(!this.state.response) {\n      // Show a loading state because data may not be available yet\n      return 'Loading data...'; \n    } else {\n      return (<h1>{response.data[0]}</h1>);\n    }\n  }\n}\n\nReactDOM.render(XtzDisplay, document.getElementById('app'));\n  \nconst App = () => {\n  const [tokenInstance, setTokenInstance] = useState(undefined);\n  const [ledgerInstance, setLedgerInstance] = useState(undefined);\n  const [ledgerInfo, setLedgerInfo] = useState(undefined);\n  const [userAddress, setUserAddress] = useState(undefined);\n  const [balance, setBalance] = useState(undefined);\n  const [isOwner, setIsOwner] = useState(false);\n  const [contractBalance, setContractBalance] = useState(0);\n  const tezbridge = window.tezbridge;\n\n  const tezosPrice = async () => {\n    try {\n      const req = await fetch(`https://api-pub.bitfinex.com/v2/ticker/tXTZUSD`)\n      const response = await req.json()               \n      const _xtz = Number(response[0])\n      setXtzPrice(_xtz);\n    } catch (error) {\n      console.log(\"error fetching xtz price:\", error);\n    }\n\n  }\n\n  const initWallet = async () => {\n    try {\n      // sets rpc host\n      /*const rpc = await tezbridge.request({\n        method: \"set_host\",\n        host: \"http://localhost:8732\"\n      });*/\n      // gets user's address\n      const _address = await tezbridge.request({ method: \"get_source\" });\n      setUserAddress(_address);\n      // gets user's balance\n      const _balance = await Tezos.tz.getBalance(_address);\n      setBalance(_balance);\n      const storage = await tokenInstance.storage();\n      if (storage.owner === _address) {\n        setIsOwner(true);\n        const _contractBalance = await Tezos.tz.getBalance(KT_token);\n        setContractBalance(_contractBalance.c[0]);\n      }\n    } catch (error) {\n      console.log(\"error fetching the address or balance:\", error);\n    }\n  };\n  const mint = async (mintNumber,xtz) => {\n    // sends mint request\n    const price = mintNumber / 1000000 / xtz;\n    const op = await tokenInstance.methods.mint(mintNumber).send({ amount: price.toFixed(4) });\n    // waits for confirmation\n    await op.confirmation(30);\n    // if confirmed\n    if (op.includedInBlock !== Infinity) {\n      const newBalance = await Tezos.tz.getBalance(userAddress);\n      setBalance(newBalance);\n    } else {\n      console.log(\"error\");\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      // sets RPC\n      Tezos.setProvider({\n        rpc: \"https://tezos-dev.cryptonomic-infra.tech\",\n        signer: new TezBridgeSigner()\n      });\n      // fetches contract storage\n      const tokenContract = await Tezos.contract.at(KT_token);\n      setTokenInstance(tokenContract);\n      const ledgerContract = await Tezos.contract.at(KT_ledger);\n      setLedgerInstance(ledgerContract);\n      const ledgerStorage = await ledgerContract.storage();\n      // creates token contract info\n      let ledgerInfos = [ledgerStorage.debtor,ledgerStorage.totalCredit];\n      setLedgerInfo(ledgerInfos);\n    })();\n  }, []);\n  return (\n    <div className=\"App\">\n      <div className=\"wallet\">\n        {balance === undefined ? (\n          <button\n            className=\"button is-info is-light is-small\"\n            onClick={initWallet}\n          >\n            Connect your wallet\n          </button>\n        ) : (\n          <>\n            <span className=\"balance\">ꜩ {balance.toNumber() / 1000000}</span>\n            <div className=\"field is-grouped\">\n              <p className=\"control\">\n                <button\n                  className=\"button is-success is-light is-small\"\n                  onClick={async () => {\n                    setUserAddress(undefined);\n                    setBalance(undefined);\n                    setIsOwner(undefined);\n                    setXtzPrice(undefined);\n                    await initWallet();\n                    await tezosPrice();\n                  }}\n                >\n                  {shortenAddress(userAddress)}\n                </button>\n              </p>\n              {isOwner && (\n                <p className=\"control\">\n                  <button\n                    className=\"button is-warning is-light is-small\"\n                    onClick={async () => {\n                     mint(document.getElementById(\"tokenNumber\").value,response.data[0]);\n                     document.getElementById(\"tokenNumber\").value = \"\";\n\n                     // get xtz price\n                     //if (typeof xtzPrice !== 'undefined') {\n                     //  mint(document.getElementById(\"tokenNumber\").value,xtzPrice);\n                     //  document.getElementById(\"tokenNumber\").value = \"\";\n                     //} else {\n                     //  setTimeout(1000)\n                     //} \n                    }\n                    }\n                  >\n                    Mint token\n                  </button>\n                  <input type=\"text\" id=\"tokenNumber\"></input>\n                </p>\n              )}\n            </div>\n          </>\n        )}\n      </div>\n      <div className=\"app-title\">Flexible Loans</div>\n      <div className=\"logo\">\n        <img src=\"coffee-maker.png\" alt=\"logo\" />\n      </div>\n      {typeof ledgerInfo === 'undefined' ? (\n        \"Loading the ledger info...\"\n      ) : (\n        <Menu\n          ledgerInfo={ledgerInfo}\n          tokenInstance={tokenInstance}\n          ledgerInstance={ledgerInstance}\n          userAddress={userAddress}\n          //xtzPrice={xtzPrice}\n          setBalance={setBalance}\n          Tezos={Tezos}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}